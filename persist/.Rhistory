scale_color_manual(values = c("#ff9999","#005555"))+
scale_x_discrete(position = "top")+
theme_light()+
ylab(label = "Net Change in Proportional Occurrence")+
xlab(label="")+
ggtitle(label = "Declining Species")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=0,face = 2),
legend.title = element_blank(),
panel.grid.major.x = element_blank(),
panel.border = element_blank(),
axis.text.y = element_text(size=12),
axis.ticks.x = element_blank())
declining
NET=read.csv("PersistenceMetrics.csv")
NET=NET%>%pivot_longer(cols = c(28:121),names_to = "Species",values_to = "change")
NET=subset(NET,!is.na(NET$change))
NET2=NET%>%group_by(Species)%>%summarise(net=sum(change))
NET3=NET%>%filter(change!=-1)%>%group_by(Species)%>%summarise(LateNum=length(change))
NET=NET%>%filter(change!=1)%>%group_by(Species)%>%summarise(EarlyNum=length(change))
NET=left_join(NET2,NET,by="Species")
NET=left_join(NET,NET3,by="Species")
NET$EarlyNum[which(is.na(NET$EarlyNum))]=0
NET$LateNum[which(is.na(NET$LateNum))]=0
NET$propChange=NA
NET$propChange=NET$LateNum/NET$EarlyNum
NETsub=subset(NET,NET$EarlyNum>=10|NET$LateNum>=10)
NETsub=subset(NETsub,NETsub$Species!="ONC" & NETsub$Species!="FMxWSU")
traits=read.csv("traits.csv")
traits=traits%>%rename("Species"="Code")
NETsub=left_join(NETsub,traits,by="Species")
NETsub$CommonName[which(NETsub$CommonName=="Northern Redbelly Dace")]="Nor. Redbelly Dace"
NETsub$CommonName[which(NETsub$CommonName=="Rocky Mountain Cutthroat Trout")]="R.M. Cutthroat Trout"
declining=NETsub%>%filter(propChange<1)%>%
ggplot(aes(x=reorder(CommonName,propChange),y=propChange))+
geom_segment( aes(x=CommonName, xend=CommonName, y=1, yend=propChange), color="grey") +
geom_point(aes(colour = as.factor(Status)), size=3)+
scale_color_manual(values = c("#ff9999","#005555"))+
scale_x_discrete(position = "top")+
theme_light()+
ylab(label = "Net Change in Proportional Occurrence")+
xlab(label="")+
ggtitle(label = "Declining Species")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=0,face = 2),
legend.title = element_blank(),
panel.grid.major.x = element_blank(),
panel.border = element_blank(),
axis.text.y = element_text(size=12),
axis.ticks.x = element_blank())
declining
################################################################
library(SSNbler)
library(SSN2)
library(caret)
library(tidyverse)
library(sf)
###Limit to native species with over 30 sites present (if ever present at a site)
sp30=c("FHMN","LNDC","CRCH","LNSU","WSU","GSUN","SDSH","CARP","LL","RB","BLBH","LKCH","BRMN","PLMN","SHRH","FHCH","SCAT","RCSU","EB","PLSU","CCAT","SPDC","MTSU","COLCOT","RSSH","FMSU")
nssn$obs$FHMN=as.numeric(nssn$obs$FHMN)
nssn$obs$LNDC=as.numeric(nssn$obs$LNDC)
nssn$obs$CRCH=as.numeric(nssn$obs$CRCH)
nssn$obs$LNSU=as.numeric(nssn$obs$LNSU)
nssn$obs$WSU=as.numeric(nssn$obs$WSU)
nssn$obs$GSUN=as.numeric(nssn$obs$GSUN)
nssn$obs$SDSH=as.numeric(nssn$obs$SDSH)
nssn$obs$CARP=as.numeric(nssn$obs$CARP)
nssn$obs$LL=as.numeric(nssn$obs$LL)
nssn$obs$RB=as.numeric(nssn$obs$RB)
nssn$obs$BLBH=as.numeric(nssn$obs$BLBH)
nssn$obs$LKCH=as.numeric(nssn$obs$LKCH)
nssn$obs$BRMN=as.numeric(nssn$obs$BRMN)
nssn$obs$PLMN=as.numeric(nssn$obs$PLMN)
nssn$obs$SHRH=as.numeric(nssn$obs$SHRH)
nssn$obs$FHCH=as.numeric(nssn$obs$FHCH)
nssn$obs$SCAT=as.numeric(nssn$obs$SCAT)
nssn$obs$RCSU=as.numeric(nssn$obs$RCSU)
nssn$obs$EB=as.numeric(nssn$obs$EB)
nssn$obs$PLSU=as.numeric(nssn$obs$PLSU)
nssn$obs$CCAT=as.numeric(nssn$obs$CCAT)
nssn$obs$SPDC=as.numeric(nssn$obs$SPDC)
nssn$obs$MTSU=as.numeric(nssn$obs$MTSU)
nssn$obs$COLCOT=as.numeric(nssn$obs$COLCOT)
nssn$obs$RSSH=as.numeric(nssn$obs$RSSH)
nssn$obs$FMSU=as.numeric(nssn$obs$FMSU)
net30=subset(NET,NET$Species%in%sp30)
net30 = subset(net30,net30$net<0)
sp30ex = subset(net30, net30$Species!="RSSH" & net30$Species!="EB" &net30$Species!="BLBH")
sp30ex=as.list(sp30ex$Species)
sp30ex
#BRMN
BRMN.global <- ssn_glm(
formula =   BRMN~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(BRMN.global)
loocv_mod <- loocv(BRMN.global)
print(loocv_mod$RMSPE)
#COLCOT
COLCOT.global <- ssn_glm(
formula =   COLCOT~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(COLCOT.global)
loocv_mod <- loocv(COLCOT.global)
print(loocv_mod$RMSPE)
#FHCH
FHCH.global <- ssn_glm(
formula =   FHCH~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(FHCH.global)
loocv_mod <- loocv(FHCH.global)
print(loocv_mod$RMSPE)
#FHMN
FHMN.global <- ssn_glm(
formula =   FHMN~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(FHMN.global)
loocv_mod <- loocv(FHMN.global)
print(loocv_mod$RMSPE)
#FMSU
FMSU.global <- ssn_glm(
formula =   FMSU~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(FMSU.global)
loocv_mod <- loocv(FMSU.global)
print(loocv_mod$RMSPE)
#LKCH
LKCH.global <- ssn_glm(
formula =   LKCH~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(LKCH.global)
loocv_mod <- loocv(LKCH.global)
print(loocv_mod$RMSPE)
#LNDC
LNDC.global <- ssn_glm(
formula =   LNDC~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(LNDC.global)
loocv_mod <- loocv(LNDC.global)
print(loocv_mod$RMSPE)
#LNSU
LNSU.global <- ssn_glm(
formula =   LNSU~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(LNSU.global)
loocv_mod <- loocv(LNSU.global)
print(loocv_mod$RMSPE)
#MTSU
MTSU.global <- ssn_glm(
formula =   MTSU~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(MTSU.global)
loocv_mod <- loocv(MTSU.global)
print(loocv_mod$RMSPE)
#COLCOT
COLCOT.global <- ssn_glm(
formula =   COLCOT~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(COLCOT.global)
loocv_mod <- loocv(COLCOT.global)
print(loocv_mod$RMSPE)
#PLMN
PLMN.global <- ssn_glm(
formula =   PLMN~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(Length_km)+scale(nnPreds), #all sites must have a DS barrier (or not)---wouldn't run with it
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(PLMN.global)
loocv_mod <- loocv(PLMN.global)
print(loocv_mod$RMSPE)
#PLSU
PLSU.global <- ssn_glm(
formula =   PLSU~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(PLSU.global)
loocv_mod <- loocv(PLSU.global)
print(loocv_mod$RMSPE)
#SPDC
SPDC.global <- ssn_glm(
formula =   SPDC~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(SPDC.global)
loocv_mod <- loocv(SPDC.global)
print(loocv_mod$RMSPE)
#WSU
WSU.global <- ssn_glm(
formula =   WSU~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(WSU.global)
loocv_mod <- loocv(WSU.global)
print(loocv_mod$RMSPE)
#BLBH
BLBH.global <- ssn_glm(
formula =   BLBH~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(BLBH.global)
loocv_mod <- loocv(BLBH.global)
print(loocv_mod$RMSPE)
#EB
EB.global <- ssn_glm(
formula =   EB~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(EB.global)
loocv_mod <- loocv(EB.global)
print(loocv_mod$RMSPE)
#RSSH
RSSH.global <- ssn_glm(
formula =   RSSH~ scale(S1_93_11)+scale(F_MAUG_HIS)+scale(DSbarrier)+scale(Length_km)+scale(nnPreds),
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(RSSH.global)
loocv_mod <- loocv(RSSH.global)
print(loocv_mod$RMSPE)
#BRMN
BRMN.global <- ssn_glm(
formula =   BRMN~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
summary(BRMN.global)
#BRMN
BRMN.global <- ssn_glm(
formula =   BRMN~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(BRMN.global)
print(loocv_mod$RMSPE)
#COLCOT
COLCOT.global <- ssn_glm(
formula =   COLCOT~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(COLCOT.global)
print(loocv_mod$RMSPE)
#FHCH
FHCH.global <- ssn_glm(
formula =   FHCH~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(FHCH.global)
print(loocv_mod$RMSPE)
#FHMN
FHMN.global <- ssn_glm(
formula =   FHMN~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(FHMN.global)
print(loocv_mod$RMSPE)
#FMSU
FMSU.global <- ssn_glm(
formula =   FMSU~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(FMSU.global)
print(loocv_mod$RMSPE)
#LKCH
LKCH.global <- ssn_glm(
formula =   LKCH~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(LKCH.global)
print(loocv_mod$RMSPE)
#LNDC
LNDC.global <- ssn_glm(
formula =   LNDC~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(LNDC.global)
print(loocv_mod$RMSPE)
#LNSU
LNSU.global <- ssn_glm(
formula =   LNSU~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(LNSU.global)
print(loocv_mod$RMSPE)
#MTSU
MTSU.global <- ssn_glm(
formula =   MTSU~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(MTSU.global)
print(loocv_mod$RMSPE)
#PLMN
PLMN.global <- ssn_glm(
formula =   PLMN~ 1, #all sites must have a DS barrier (or not)---wouldn't run with it
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(PLMN.global)
print(loocv_mod$RMSPE)
#PLSU
PLSU.global <- ssn_glm(
formula =   PLSU~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(PLSU.global)
print(loocv_mod$RMSPE)
#SPDC
SPDC.global <- ssn_glm(
formula =   SPDC~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(SPDC.global)
print(loocv_mod$RMSPE)
#WSU
WSU.global <- ssn_glm(
formula =   WSU~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(WSU.global)
print(loocv_mod$RMSPE)
#BLBH
BLBH.global <- ssn_glm(
formula =   BLBH~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(BLBH.global)
print(loocv_mod$RMSPE)
#EB
EB.global <- ssn_glm(
formula =   EB~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(EB.global)
print(loocv_mod$RMSPE)
#RSSH
RSSH.global <- ssn_glm(
formula =   RSSH~ 1,
family = "binomial",
ssn.object = nssn,
tailup_type = "exponential",
taildown_type = "exponential",
euclid_type = "exponential",
random = ~as.factor(Yrange),
additive = "afvArea", estmethod = "ml")
loocv_mod <- loocv(RSSH.global)
print(loocv_mod$RMSPE)
